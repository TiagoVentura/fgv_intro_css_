subtitle = unique(res_job$outcome_label),
caption ="Note: Positive point estimates indicates respondents fell more at risk of losing their jobs") +
facet_wrap(~subsample) +
coord_flip()
mod_health <- lm(as.numeric(covid_health) - mean(as.numeric(covid_health), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=treatment_framing)
mod_health_bartres <- lm(as.numeric(covid_health)- mean(as.numeric(covid_health), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=d_morena)
mod_health_calderon <- lm(as.numeric(covid_health)- mean(as.numeric(covid_health), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=d_pan)
mod_health_pri <- lm(as.numeric(covid_health) - mean(as.numeric(covid_health), na.rm=TRUE)~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=d_pri)
mod_health_ind <- lm(as.numeric(covid_health)- mean(as.numeric(covid_health), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=d_ind)
list_models <- list(mod_health, mod_health_calderon, mod_health_bartres, mod_health_pri, mod_health_ind)
list_subsamples <- list("All", "PAN", "Morena","PRI",
"Independents")
res_health <- map2_df(list_models, list_subsamples,
~ tidy_model_all_together(.x, "covid_health", subsample=.y))
ggplot(res_health, aes(y=estimate, x=term,
ymin=up, ymax=lb)) +
geom_pointrange(shape=21, fill="white", size=2) +
labs(x="", y="Average Treatment Effects",
title = "Health Risks, Covid-19 and Partisanship in Mexico",
subtitle = unique(res_health$outcome_label),
caption ="Note: Positive point estimates imply respondents fell more at risk of being infected by COVID-19") +
facet_wrap(~subsample) + guides(color=FALSE) +
coord_flip()
mod_gov <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=treatment_framing)
mod_gov_bartres <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=d_morena)
mod_gov_calderon <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=d_pan)
mod_gov_pri <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=d_pri)
mod_gov_ind <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=d_ind)
list_models <- list(mod_gov, mod_gov_calderon, mod_gov_bartres, mod_gov_pri,mod_gov_ind)
list_subsamples <- list("All", "PAN", "Morena","PRI",
"Independents")
res_gov <- map2_df(list_models, list_subsamples,
~ tidy_model_all_together(.x, "covid_gov", subsample=.y))
# Plot
ggplot(res_gov, aes(y=estimate, x=term,
ymin=up, ymax=lb)) +
geom_pointrange(shape=21, fill="white", size=2) +
labs(x="", y="Average Treatment Effects",
title = "Government Response, Covid-19 and Partisanship in Mexico",
subtitle = unique(res_gov$outcome_label),
caption ="Note: Positive point estimates imply respondents show greater support for the government response") +
facet_wrap(~subsample) + guides(color=FALSE) +
coord_flip()
d_anti_morena <- treatment_framing %>%
filter(antimorena==1)
d_anti_pri <- treatment_framing %>%
filter(antipri==1)
d_anti_pan <- treatment_framing %>%
filter(antipan==1)
dim(d_anti_morena)
dim(d_anti_pri)
dim(d_anti_pan)
# Modeling ----------------------------------------------------------------
d_subset <- list(d_anti_morena, d_anti_pan, d_anti_pri)
list_subsamples <- c("Anti-Morena", "Anti-Pan", "Anti-Pri")
res_n_job <- map2_dfr(d_subset, list_subsamples, ~
lm(as.numeric(covid_job) - mean(as.numeric(covid_job), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=.x) %>%
tidy_model_all_together(., "covid_job",
.y))
res_n_health <- map2_dfr(d_subset, list_subsamples, ~
lm(as.numeric(covid_health) - mean(as.numeric(covid_health), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=.x) %>%
tidy_model_all_together(., "covid_health",
.y))
res_n_gov <- map2_dfr(d_subset, list_subsamples, ~
lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=.x) %>%
tidy_model_all_together(., "covid_jgov",
.y))
d_anti_morena2 <- treatment_framing %>%
filter(str_detect(negative_partisanship, "MORENA"))
d_anti_pri2 <- treatment_framing %>%
filter(str_detect(negative_partisanship, "PRI"))
d_anti_pan2 <- treatment_framing %>%
filter(str_detect(negative_partisanship,"PAN"))
# Modeling ----------------------------------------------------------------
d_subset <- list(d_anti_morena2, d_anti_pan2, d_anti_pri2)
list_subsamples <- c("Anti-Morena", "Anti-Pan", "Anti-Pri")
res_n_job2 <- map2_dfr(d_subset, list_subsamples, ~
lm(as.numeric(covid_job) - mean(as.numeric(covid_job), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=.x) %>%
tidy_model_all_together(., "covid_job",
.y))
res_n_health2 <- map2_dfr(d_subset, list_subsamples, ~
lm(as.numeric(covid_health) - mean(as.numeric(covid_health), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=.x) %>%
tidy_model_all_together(., "covid_health",
.y))
res_n_gov2 <- map2_dfr(d_subset, list_subsamples, ~
lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ -1 + negative_calderon +
negative_bartres +
neutral_calderon +
neutral_bartres,  data=.x) %>%
tidy_model_all_together(., "covid_jgov",
.y))
# Putting results together ------------------------------------------------
results_bind <- bind_rows(res_job, res_health, res_gov) %>%
mutate(subsample=fct_relevel(subsample, "All", "Morena",
"PAN", "PRI", "Independents"))
green <- RColorBrewer::brewer.pal(5, "Greens")
ggplot(results_bind,
aes(y=estimate, x=term, fill=subsample,
ymin=up, ymax=lb)) +
geom_pointrange(size=1, shape=21, color="grey5",
position=position_dodge(width = .6)) +
scale_fill_manual(values=c("white", pal[1], pal[9], green[3], pal[4]), name="") +
labs(x="Treatment Conditons", y="Treatment Effects",
title = "Partisan Responses and Risk Perceptions abou the Covid-19 in Mexico\n",
caption ="Note: Positive point estimates imply respondents show greater support for the government response") +
facet_grid(subsample~outcome_label ) +
coord_flip()
results_n_bind <- bind_rows(res_n_job, res_n_health, res_n_gov)
glimpse(results_bind)
ggplot(results_n_bind,
aes(y=estimate, x=term, fill=subsample,
ymin=up, ymax=lb)) +
geom_pointrange(size=1, shape=21, color="grey5",
position=position_dodge(width = .6)) +
scale_fill_manual(values=c(pal[1], pal[9], green[3]), name="") +
labs(x="Treatment Conditons", y="Treatment Effects",
title = "Negative Partisanship and  Risk Perceptions about the Covid-19 in Mexico\n",
caption ="Note: Positive point estimates imply respondents show greater support for the government response") +
facet_grid(subsample~outcome_label ) +
coord_flip()
results_n_bind2 <- bind_rows(res_n_job2, res_n_health2, res_n_gov2)
ggplot(results_n_bind2,
aes(y=estimate, x=term, fill=subsample,
ymin=up, ymax=lb)) +
geom_pointrange(size=1, shape=21, color="grey5",
position=position_dodge(width = .6)) +
scale_fill_manual(values=c(pal[1], pal[9], green[3]), name="") +
labs(x="Treatment Conditons", y="Treatment Effects",
title = "Negative Partisanship and  Risk Perceptions about the Covid-19 in Mexico\n",
caption ="Note: Positive point estimates imply respondents show greater support for the government response") +
facet_grid(subsample~outcome_label ) +
coord_flip()
# Extract p-values --------------------------------------------------------
var1 <- c("negative_bartres", "negative_calderon", "neutral_bartres", "neutral_calderon")
var1 <- c("negative_bartres", "negative_calderon", "neutral_bartres", "neutral_calderon")
library(gtools)
df <- as.data.frame(combinations(n = 4, r = 2, repeats.allowed = F, v = var1)) %>%
mutate_all(as.character)
variables <-as.data.frame(t(df))
extract_p_values <- function(model, variables, dv, subsample){
map(variables, ~ linearHypothesis(model, paste0(.x[1], "=", .x[2]))$`Pr(>F)`[2]) %>%
unlist() %>% tibble(pvalue=., dv, subsample )
}
# job
modelsjob <- list( mod_job, mod_job_calderon, mod_job_bartres,mod_job_pri, mod_job_ind)
list_subsamples <- list("All", "PAN \n Voters", "Morena \n Voters","PRI \n Voters",
"Independent \n Voters")
job_results <- map2_dfr(modelsjob, list_subsamples, ~ extract_p_values(.x, variables, .y, "Job Risks") %>%
bind_cols(df, .))
#health
modelshealth <- list(mod_health, mod_health_calderon, mod_health_bartres, mod_health_pri, mod_health_ind)
list_subsamples <- list("All", "PAN \n Voters", "Morena \n Voters","PRI \n Voters",
"Independent \n Voters")
health_results <- map2_dfr(modelshealth, list_subsamples, ~ extract_p_values(.x, variables, .y, "Health Risks") %>%
bind_cols(df, .))
modelsgov <- list(mod_gov, mod_gov_calderon, mod_gov_bartres, mod_gov_pri,mod_gov_ind)
list_subsamples <- list("All", "PAN \n Voters", "Morena \n Voters","PRI \n Voters",
"Independent \n Voters")
gov_results <- map2_dfr(modelsgov, list_subsamples, ~ extract_p_values(.x, variables, .y, "Government Support") %>%
bind_cols(df, .))
res_all <- bind_rows(gov_results, job_results, health_results) %>%
mutate(subsample=fct_relevel(subsample, "Government Support", "Job Risks"),
pvalueid = ifelse(pvalue <=0.05, "p-value < 0.05",
ifelse(pvalue<=0.10, "p-value <0.10",
"p-vale > 0.10")),
pvalueid =fct_relevel(pvalueid, "p-value < 0.05",
"p-value <0.10"),
var1=str_to_title(str_replace(str_replace(V1, "_", " "), "neutral", "Positive")),
var2=str_to_title(str_replace(str_replace(V2, "_", " "), "neutral", "Positive")))
# further modified ggplot
ggplot(res_all,aes(x=var1,y=fct_rev(var2),fill=pvalueid))+
geom_tile(colour="gray95",size=0.5, alpha=.8)+
guides(fill=guide_legend(title="P-value"))+
labs(x="",y="",
title="Partisan Responses and Risk Perceptions: \n",
subtitle="P-values for the Treatment Comparisons")+
scale_fill_manual(values=c("tomato2", "pink", "white")) +
geom_text(aes(label = round(pvalue, 3))) +
facet_grid(dv~subsample ) +
theme(panel.grid = element_blank(),
axis.text.x = element_text(angle=45, hjust=1),
strip.text.y = element_text(size=12, ) )
mod_health <- lm(as.numeric(covid_health) - mean(as.numeric(covid_health), na.rm=TRUE) ~ treat_negative, data=treatment_framing)
mod_job <- lm(as.numeric(covid_job) - mean(as.numeric(covid_job), na.rm=TRUE)~ treat_negative, data=treatment_framing)
mod_gov <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE)~ treat_negative, data=treatment_framing)
list_models <- list(mod_health, mod_job, mod_gov)
list_outputs <- list("covid_health", "covid_job", "covid_government")
res_negative_tweets <- map2_df(list_models, list_outputs,
~ tidy_model(.x, .y, "Negative Tweet", "All"))
d_morena <- treatment_framing %>%
filter(vote_morena=="On")
## bartres
mod_health <- lm(as.numeric(covid_health) - mean(as.numeric(covid_health), na.rm=TRUE) ~ treat_negative, data=d_morena)
mod_job <- lm(as.numeric(covid_job) - mean(as.numeric(covid_job), na.rm=TRUE) ~ treat_negative, data=d_morena)
mod_gov <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE)~ treat_negative, data=d_morena)
list_models <- list(mod_health, mod_job, mod_gov)
res_m_negative <- map2_df(list_models, list_outputs,
~ tidy_model(.x, .y, "Negative Tweet", "Morena Voters"))
## independent
d_ind <- treatment_framing %>%
filter(independent==1)
mod_health <- lm(as.numeric(covid_health) - mean(as.numeric(covid_health), na.rm=TRUE) ~ treat_negative, data=d_ind)
mod_job <- lm(as.numeric(covid_job) - mean(as.numeric(covid_job), na.rm=TRUE)~ treat_negative, data=d_ind)
mod_gov <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ treat_negative, data=d_ind)
list_models <- list(mod_health, mod_job, mod_gov)
res_i_negative <- map2_df(list_models, list_outputs,
~ tidy_model(.x, .y, "Negative Tweet", "Independent Voters"))
## calderon
d_pan <- treatment_framing %>%
filter(vote_pan=="On")
mod_health <- lm(as.numeric(covid_health) - mean(as.numeric(covid_health), na.rm=TRUE)~ treat_negative, data=d_pan)
mod_job <- lm(as.numeric(covid_job) - mean(as.numeric(covid_job), na.rm=TRUE) ~ treat_negative, data=d_pan)
mod_gov <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ treat_negative, data=d_pan)
list_models <- list(mod_health, mod_job, mod_gov)
res_pan_negative <- map2_df(list_models, list_outputs,
~ tidy_model(.x, .y, "Negative Tweet", "PAN Voters"))
## Pri
d_pri <- treatment_framing %>%
filter(vote_pri=="On")
mod_health <- lm(as.numeric(covid_health) - mean(as.numeric(covid_health), na.rm=TRUE) ~ treat_negative, data=d_pri)
mod_job <- lm(as.numeric(covid_job) - mean(as.numeric(covid_job), na.rm=TRUE) ~ treat_negative, data=d_pri)
mod_gov <- lm(as.numeric(covid_government) - mean(as.numeric(covid_government), na.rm=TRUE) ~ treat_negative, data=d_pri)
list_models <- list(mod_health, mod_job, mod_gov)
res_pri_negative <- map2_df(list_models, list_outputs,
~ tidy_model(.x, .y, "Negative Tweet", "PRI Voters"))
results <- bind_rows(res_negative_tweets, res_m_negative, res_i_negative, res_pan_negative, res_pri_negative)
ggplot(results, aes(y=estimate, x=subsample,
ymin=up, ymax=lb)) +
geom_pointrange(shape=21, fill="white", size=2) +
labs(x="", y="Average Treatment Effects",
title = "Framing Effects about Covid-19 and Partisanship in Mexico",
subtitle = "Treatment Condition: Negative Tweets",
caption ="Note: Positive point estimates imply respondents show greater support \n for the government, or fell more at risk of losing their jobs or being infected by COVID-19") +
geom_hline(yintercept = 0, linetype="dashed", color="darkred") +
facet_wrap(~outcome_label) + guides(color=FALSE) +
coord_flip()
xaringan::inf_mr()
library(cepespR)
library(tidyverse)
# Banco Candidatos Brasil inteiro
candidatos <- get_candidates(year=2018, position="Federal Deputy") %>%
as_tibble()
# Banco Votos
votos <- get_votes(year = 2018, position="Federal Deputy", state="RJ") %>%
as_tibble()
# Usando group_by
candidatos %>%
group_by(NUMERO_PARTIDO) %>%
glimpse()
votos_mais1 <-votos %>%
filter(QTDE_VOTOS > 0) %>%
distinct(NUMERO_CANDIDATO)
dim(votos_mais1)
votos
dim(votos)
votos %>%
arrange(desc(QTDE_VOTOS))
votos %>%
arrange(desc(QTDE_VOTOS)) %>%
select(NUMERO_CANDIDATO, QTDE_VOTOS)
votos %>%
arrange(desc(QTDE_VOTOS)) %>%
select(NUMERO_CANDIDATO, QTDE_VOTOS, NOME_MUNICIPIO)
votos %>%
group_by(NUMERO_CANDIDATO) %>%
summarise(votos=sum(QTDE_VOTOS)) %>%
arrange(desc(votos))
# Esta é mais complexa. Para começar, estou criando para vocês a variável partido.
votos <- votos %>%
# nova variável com os primeiros dois numeros de cada candidato
# igual ao número do partido
mutate(NR_PARTIDO=str_sub(NUMERO_CANDIDATO, 1, 2))
votos %>%
group_by(NR_PARTIDO)
votos %>%
group_by(NR_PARTIDO) %>%
summarise(votos_pt=sum(QTDE_VOTOS))
votos %>%
group_by(NR_PARTIDO) %>%
summarise(votos_pt=sum(QTDE_VOTOS))
votos %>%
group_by(NR_PARTIDO) %>%
summarise(votos_pt=sum(QTDE_VOTOS)) %>%
mutate(votos_total=sum(votos_pt))
votos %>%
group_by(NR_PARTIDO) %>%
summarise(votos_pt=sum(QTDE_VOTOS)) %>%
mutate(votos_total=sum(votos_pt),
prop_votos=votos_pt/votos_total)
# Daqui pra frente é com vocês
votos %>%
group_by(NR_PARTIDO) %>%
summarise(votos_pt=sum(QTDE_VOTOS)) %>%
mutate(votos_total=sum(votos_pt),
prop_votos=votos_pt/votos_total) %>%
arrange(desc(prop_votos)) %>%
slice(1:10)
data1 <- tibble(nome=c("A", "B", "C"),
value=c(10, 20, 30))
data2 <- tibble(nome=c("A", "D", "C"),
value2=c(10, 50, 30))
data1
data2
left_join(data1, data2)
data1
left_join(data1, data2)
left_join(data1, data2, by=c("nome"))
inner_join(data1, data2)
data1
data2
inner_join(data1, data2)
data1 <- tibble(nome=c("A", "B", "C"),
value=c(10, 20, 30))
data2 <- tibble(nome=c("A", "D", NA),
value2=c(10, 50, 30))
left_join(data1, data2, by=c("nome"))
left_join(data1, data2, by=c("nome"))
inner_join(data1, data2)
full_join(data1, data2)
data1 <- tibble(nome=c("A", "B", "C"),
value=c(10, 20, 30))
data2 <- tibble(nome=c("A", "D", "C"),
value2=c(10, 50, 30))
full_join(data1, data2)
# Chaves Distintas
data3 <- data2 %>%
# alterando o nome
select(chave=nome, everything())
# Chaves Distintas
data3 <- data2 %>%
# alterando o nome
select(chave=nome, everything())
data3
left(data1, data3)
left_join(data1, data3)
colnames(data1)
colnames(data3)
# Join
left_join(data1, data3,
by=c("nome"="chave")) # adicione argumento by.
# Multiplas Chaves
data2
data3
left_join(data2, data3,
by=c("nome"="chave", "value2"))
# Multiplas Chaves
data2
data3
left_join(data2, data3,
by=c("nome"="chave", "value2"))
left_join(data2, data3,
by=c("value2"))
left_join(data1, data2, by=c("nome"))
data1
data2
bind_rows(data1, data2)
data1
data2
# bind
bind_rows(data1, data2)
# bind
bind_cols(data1, data2)
data2 <- tibble(nome=c("A", "D", "C","D"),
value2=c(10, 50, 30, 50))
# bind
bind_cols(data1, data2)
data1 <- tibble(nome=c("A", "B", "C"),
value=c(10, 20, 30))
data2 <- tibble(nome=c("A", "D", "C"),
value2=c(10, 50, 30))
data1
data2
library(cepespR)
library(tidyverse)
# Banco Votos Presidente Rio de Janeiro
votos <- get_candidates(year=2018, position="Presidente") %>%
as_tibble()
# Banco Votos
cepespR::get_filiates(state = "all", party="PT")
# Banco Votos
?get_careers
# Banco Votos
a <- get_assets(year = 2014, state = "AC", columns_list = list('CODIGO_CARGO','NOME_CANDIDATO','CPF_CANDIDATO','VALOR_BEM'))
a
# Banco Votos
a <- get_assets(year = 2014, state = "AC"))
# Banco Votos
a <- get_assets(year = 2014, state = "AC")
a
# Banco Votos Presidente Rio de Janeiro
votos <- get_candidates(year=2018, position="Federal Deputy") %>%
as_tibble()
# Banco Bens Candidatos
bens <- get_assets(year = 2018, state = "RJ")
?get_assets
?get_assets
library(cepespR)
library(tidyverse)
?get_assets
??get_assets
# Banco Bens Candidatos
bens <- get_assets(year = 2018, state = "RJ", position="Federal Deputy")   %>%
as_tibble()
# Banco Bens Candidatos
bens <- get_assets(year = 2018, state = "RJ")   %>%
as_tibble()
colnames(bens)
table(bens$DESCRICAO_CARGO)
colnames(bens)
colnames(votos)
left_join(votos, bens)
dim(votos)
dim(bens)
# Banco Votos Deputado
votos <- get_candidates(year=2018, position="Federal Deputy") %>%
as_tibble()
# Banco Votos Deputado
votos <- get_candidates(year=2018, position="Federal Deputy", state="RJ") %>%
as_tibble()
# Banco Votos Deputado
votos <- get_votes(year=2018, position="Federal Deputy", state="RJ") %>%
as_tibble()
# Banco Bens Candidatos
bens <- get_assets(year = 2018, state = "RJ")   %>%
as_tibble()
colnames(votos)
bens
# Banco Votos Deputado
candidatos <- get_candidates(year=2018, position="Federal Deputy") %>%
as_tibble()
# Banco Bens Candidatos
bens <- get_assets(year = 2018, state = "RJ")   %>%
as_tibble()
get_filiates(state = 'AC', party = 'PT')
library(tidyr)
tidyr::construction
billboard
construction
construction
construction %>%
pivot_longer(cols=contains("units"),
names_to="d",
values_to="s")
construction %>%
pivot_longer(cols=contains("unit"),
names_to="d",
values_to="s")
?pivot_longer
construction
# Responda
construction %>%
pivot_longer(cols=contains("unit"),
names_to="unit",
values_to="unit_values")
# Responda
construction %>%
pivot_longer(cols=contains("unit"),
names_to="unit",
values_to="unit_values") %>%
pivot_longer(cols = c("Northeast", "Midwest", "West", "South"),
names_to="Region",
values_to="Region_values")
fish_encounters
fish_encounters %>%
pivot_wider(names_from = station,
values_from=seen)
fish_encounters
