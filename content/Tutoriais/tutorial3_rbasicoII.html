---
title: "Tutorial 3: Introdução ao R Parte II"
output:
    rmdformats::robobook:
      code_folding: show
      self_contained: true
      thumbnails: false
      lightbox: true
number_sections: true
editor_options: 
  chunk_output_type: console
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="introdução" class="section level1">
<h1>Introdução</h1>
<p>Na aula passada, fizemos uma rápida introdução ao R. Vimos os seguintes pontos:</p>
<ul>
<li>Como interagir com R via R Studio.</li>
<li>Como instalar pacotes.</li>
<li>Estrutura de Dados em R.</li>
<li>Pedindo Ajuda em R.</li>
<li>Operadores Lógicos e Booleanos.</li>
<li>Classes de Objetos.</li>
<li>Estrutura de Dados.</li>
</ul>
<p>Hoje, iremos concluir esta nossa rápida introdução discutindo três novos tópicos fundamentais pra o uso do R:</p>
<ul>
<li>Linguagem Condicionais.</li>
<li>Loops.</li>
<li>Funções.</li>
</ul>
<p>Inegávelmente, estes três tópicos de hoje são mais complexos do que os da aula anterior. E provavelmente compreendê-los demandará algum tempo de prática. Porém, estes três tópicos são fundamentais na vida de qualquer programador, e permitirá a vocês com o tempo expandir, e usar em larga escala, seus conhecimentos de R.</p>
</div>
<div id="funções" class="section level1">
<h1>Funções</h1>
<p>Em qualquer processo de trabalho, muitas vezes precisamos repetir a mesma operação diversas vezes. Por exemplo, precisamos tira a média por grupos em nossa banco de dados, limpar determinada variável em bancos de dados diferentes, e etc. Nesta dinâmica de repetir determinada operação de forma sistemática, <strong>loops</strong> e <strong>funções</strong> são fundamentais para tornar nosso trabalho mais eficiente.</p>
<div id="o-que-são-funcões" class="section level2">
<h2>O que são funcões?</h2>
<p>Funções são tudo que gera um output em R. Absolutamente tudo. R é definido como uma linguagem funcional de programção, o que significa que todas os comandos que retornam algum resultado em R vêm de uma função. Por exemplo:</p>
<pre class="r"><code># Crie um objeto
x &lt;- sample(1:100, 10)

# Aplique a função para extrair a média
mean(x)</code></pre>
<pre><code>## [1] 47.4</code></pre>
<p><code>mean()</code> é uma função pré-definida no R. Assim como a função <code>sample()</code> que usamos acima também.</p>
</div>
<div id="argumentos" class="section level2">
<h2>Argumentos</h2>
<p>Diferente de objetos, que usamos para guardar valores, funções funcionam numa lógica de input e output. Chamamos os <strong>inputs</strong> de uma função de <strong>Argumentos</strong>, e são os argumentos que vão dentro dos parentesis de cada função.</p>
<pre class="r"><code>function(arg1, arg2, arg3, arg4, ....)</code></pre>
<p>Como vimos anteriormente, pacotes são somente um conjunto novo de funções que você baixou da internet, e que foi criado para ser compartilhado ao público. Por exemplo:</p>
<ul>
<li><code>dplyr</code>: pacote com funções para manipulação de dados.</li>
<li><code>ggplot2</code>: pacote com funções de visualização.</li>
<li><code>wesanderson</code>: funções para gerar paleta de cores dos filmes do Wes Anderson em R.</li>
</ul>
<p>Além dos pacotes, o R vem com alguns funções pré-construídas. Por exemplo, <code>paste()</code>, <code>mean()</code>, <code>sd()</code>, <code>c()</code>, <code>dim()</code>, <code>class()</code>, <code>typeof()</code>, <code>as.character()</code>, ente muitas outras são funções da base do R.</p>
</div>
<div id="desafio-1." class="section level2">
<h2>Desafio 1.</h2>
<p>Com base no que discutimos, expliquem-me como a função c() funciona. Qual seu output? Quais os argumentos?</p>
<pre class="r"><code>?c</code></pre>
<p><img src="figs/c_help.png" width="80%" /></p>
</div>
<div id="criando-nossas-próprias-funções." class="section level2">
<h2>Criando nossas próprias funções.</h2>
<p>Com frequência, no entanto, estaremos interessados em escrever nossas próprias funções. Mesmo que você nunca crie um pacote em R, as vezes você precisará escrever suas funções para repetir suas rotinas em R.</p>
<p>Vamos construir uma função simples que <strong>adiciona dois valores</strong>. Aqui, a função terá dois argumentos, em outras palavras, dois <em>valores</em> que precisam ser inseridos para que a função seja executada.</p>
<p>Construir funções ajudará você a optimizar seu código, e principalmente, a compreender melhor os códigos de outros programadores e como seus pacotes funcionam.</p>
<pre class="r"><code>some_me &lt;- function( argument1, argument2 ){
  value &lt;- argument1 + argument2
  return(value) # &quot;return&quot; define qual o output da sua função. 
}

some_me(2,3)</code></pre>
<pre><code>## [1] 5</code></pre>
<pre class="r"><code>some_me(100,123)</code></pre>
<pre><code>## [1] 223</code></pre>
<pre class="r"><code>some_me(60,3^4)</code></pre>
<pre><code>## [1] 141</code></pre>
<pre class="r"><code># Podemos definir valores básicos para cada argumento
# function will still run.
some_me &lt;- function( argument1=1, argument2=2 ){
  value &lt;- argument1 + argument2
  return(value) 
}
some_me()</code></pre>
<pre><code>## [1] 3</code></pre>
<pre class="r"><code>some_me(4,5)</code></pre>
<pre><code>## [1] 9</code></pre>
<p>A estrutura básica da função é a seguinte:</p>
<ul>
<li>o nome: soma_me;</li>
<li>os argumentos: argument1 e argument2;</li>
<li>o corpo: todo o código entre os {}; e</li>
<li>o retorno:</li>
</ul>
<p>Exemplo:</p>
<pre class="r"><code>nome_da_funcao &lt;- function(x,y,z){ ## Argumentos
  ### Corpo: o que a função faz
    
    out &lt;- what the function does.
  
  ### Conclui Corpo.
    
    return(out) ## output
}
  ## fecha a função</code></pre>
</div>
<div id="quando-você-deve-escrever-uma-função" class="section level2">
<h2>Quando você deve escrever uma função?</h2>
<p>A <a href="https://r4ds.had.co.nz/functions.html">famosa sugestão</a> de Hadley Wickham - um dos principais desenvolvedores de R.</p>
<p><span class="math display">\[
\texttt{&quot;You should consider writing a function whenever} \\
\texttt{you’ve copied and pasted a block of code more than twice}
\]</span></p>
<p>Teremos uma semana inteira sobre programação funcional em R. Por isso, vamos encerrar por aqui essa breve introdução a funções. Caso você queira se adiantar, pode checar o capítulo 20 do R for Data Science de Hadley Wickham. Ou este excelente <a href="http://www.rebeccabarter.com/blog/2019-08-19_purrr/">tutorial</a> sobre programação funcional escrito por <a href="http://www.rebeccabarter.com/">Rebeca Barter</a></p>
</div>
</div>
<div id="iteração." class="section level1">
<h1>Iteração.</h1>
<p>Função são apenas uma forma de reduzir a redundância, e aumentar a transparência dos seus códigos. Um segundo aliado importante é o uso de tecnicas em iteração, em especial, <code>for loops</code>.</p>
<p>Por exemplo, após escrever nossa função, precisamos encontrar uma forma de <strong>repetí-la</strong> em larga escala. Todas as linguagens de programação - ao menos as que conheço - utilizam loops para este tipo de tarefa. Loops são exatamente o que o nome diz. É uma forma de repetir a <strong>mesma</strong> tarefa <strong>múltiplas</strong> vezes. Aqui vamos focar em <code>for loops</code></p>
<div id="exemplo-1." class="section level2">
<h2>Exemplo 1.</h2>
<p>Um <code>for loop</code> funciona basicamente iterando determinado código através de uma série de ítems salvo em um objeto de R. O código abaixo printa cada cidade em que morei.</p>
<pre class="r"><code>cidades_onde_morei &lt;- c(&quot;belem&quot;, &quot;sao paulo&quot;, &quot;rio de janeiro&quot;, &quot;berlim&quot;, &quot;brasilia&quot;, &quot;dc&quot;, &quot;rio de janeiro&quot;)

# for loop

for(cidades in cidades_onde_morei){ #iterador
  # o que repetir
  print(cidades)
  
}</code></pre>
<pre><code>## [1] &quot;belem&quot;
## [1] &quot;sao paulo&quot;
## [1] &quot;rio de janeiro&quot;
## [1] &quot;berlim&quot;
## [1] &quot;brasilia&quot;
## [1] &quot;dc&quot;
## [1] &quot;rio de janeiro&quot;</code></pre>
<p>Há dois componentes importantes nos for loops.</p>
<ol style="list-style-type: decimal">
<li><p><code>for(item in conjunto_de_items)</code>: a sequências</p>
<p>–iterador: íterador. ítem que iremos indexar nossas operações.
– conjunto_de_items: objeto de onde tiramos nosso iterador.</p></li>
<li><p>Os paretesis {}</p>
<p>– Tudo feito pelos loops vai aqui dentro.
– Incluindo como você salvará os outputs.</p></li>
</ol>
</div>
<div id="exemplo-2-tornando-o-loop-mais-geral." class="section level2">
<h2>Exemplo 2: Tornando o loop mais geral.</h2>
<p>Para tornar os loops mais gerais, normalmente utilizamos <span class="math inline">\(i\)</span> como iterador, e em formato numérico. O que significa que estamos dizendo ao R para repetir determinada operação indexando cada repetição pelo número <span class="math inline">\(i\)</span></p>
<p>Vamos a um exemplo. Vamos escrever o mesmo loop acima, porém usando indexes numéricos.</p>
<pre class="r"><code>for(i in 1:length(cidades_onde_morei)){ #iterador
  # o que repetir
  print(i)
  print(cidades_onde_morei[i])
  
}</code></pre>
<pre><code>## [1] 1
## [1] &quot;belem&quot;
## [1] 2
## [1] &quot;sao paulo&quot;
## [1] 3
## [1] &quot;rio de janeiro&quot;
## [1] 4
## [1] &quot;berlim&quot;
## [1] 5
## [1] &quot;brasilia&quot;
## [1] 6
## [1] &quot;dc&quot;
## [1] 7
## [1] &quot;rio de janeiro&quot;</code></pre>
</div>
<div id="exemplo-3-abstraindo-do-concreto." class="section level2">
<h2>Exemplo 3: Abstraindo do concreto.</h2>
<p>Vamos ao nosso último exemplo de loops. Continuaremos trabalhando com os bancos de dados do show “The British Baking”. Desta vez, vamos trabalhar com o banco de dados sobre as avaliações de cada episódio. Nosso objetivos é tirar uma média do sucesso de cada temporada</p>
<pre class="r"><code>library(bakeoff)
data(&quot;ratings_seasons&quot;)
glimpse(ratings_seasons)</code></pre>
<pre><code>## Error in glimpse(ratings_seasons): could not find function &quot;glimpse&quot;</code></pre>
<p>Vamos fazer temporada por temporada.</p>
<pre class="r"><code># Quantas temporadas?
temporadas &lt;- unique(ratings_seasons$series)
temporadas</code></pre>
<pre><code>## [1] 1 2 3 4 5 6 7 8</code></pre>
<pre class="r"><code># Média de visualizacao

#Temporada 1
temporada_1 &lt;- ratings_seasons[ratings_seasons$series==temporadas[1], ]
mean(temporada_1$viewers_7day)</code></pre>
<pre><code>## [1] 2.77</code></pre>
<pre class="r"><code>#Temporada 2
temporada_2 &lt;- ratings_seasons[ratings_seasons$series==temporadas[2], ]
mean(temporada_2$viewers_7day)</code></pre>
<pre><code>## [1] 3.95125</code></pre>
<pre class="r"><code>#Temporada 3
temporada_3 &lt;- ratings_seasons[ratings_seasons$series==temporadas[3], ]
mean(temporada_3$viewers_7day)</code></pre>
<pre><code>## [1] 5.001</code></pre>
<p>Fazer isso para 7 temporadas passara a regra do Hadley Wickham de não repetir o código mais de três vezes. Para nos mantermos fiéis a regra, vamos escrever um loop.</p>
<p>Este é exatamente o tipo de tarefa onde <strong>loops</strong> podem tornar a vida de alguém mais fácil! Ao <strong>fazer um loop</strong> por temporadas, podemos automatizar esse processo para que seja muito mais rápido.</p>
<p>Esse processo de abstração do loop funciona essencialmente assim:</p>
<ol style="list-style-type: decimal">
<li><p>Especifíque a duração de algo que deseja percorrer. No nosso caso, é o número de temporadas.</p></li>
<li><p>Configure o código de forma que cada iteração execute apenas uma manipulação em um único subconjunto por vez.</p></li>
<li><p>Salve o conteúdo de cada iteração em um novo objeto que não será sobrescrito. Aqui, queremos pensar em termos de “empilhamento” dos resultados ou concatená-los.</p></li>
</ol>
<p>Na prática, leia seu código, e veja o que se repete e o que se mantêm. E o torne mais geral.</p>
<pre class="r"><code># Crie um container para salvar seus outputs
container &lt;- list()

for(i in 1:length(temporadas)){
 temp=ratings_seasons[ratings_seasons$series==temporadas[i], ]
 container[[i]] &lt;- mean(temp$viewers_7day)  
  
}
container</code></pre>
<pre><code>## [[1]]
## [1] 2.77
## 
## [[2]]
## [1] 3.95125
## 
## [[3]]
## [1] 5.001
## 
## [[4]]
## [1] 7.354
## 
## [[5]]
## [1] 10.0393
## 
## [[6]]
## [1] 12.311
## 
## [[7]]
## [1] 13.563
## 
## [[8]]
## [1] 9.017</code></pre>
</div>
<div id="desafio-3" class="section level2">
<h2>Desafio 3</h2>
<p>O que acontece se eu alterar o loop dessa forma?</p>
<pre class="r"><code># Crie um container para salvar seus outputs
container &lt;- list()

for(i in 1:length(temporadas)){
 temp=ratings_seasons[ratings_seasons$series==temporadas[i], ]
 container &lt;- mean(temp$viewers_7day)  ## Alteração aqui.
  
}

container</code></pre>
<p>E desta forma?</p>
<pre class="r"><code>container &lt;- list()

for(i in temporadas){ # Aqui
 temp=ratings_seasons[ratings_seasons$series==i,] # Aqui
 container[[i]] &lt;- mean(temp$viewers_7day)  ## Alteração aqui. 
  
}

container</code></pre>
</div>
</div>
<div id="condicionais." class="section level1">
<h1>Condicionais.</h1>
<p>Como toda linguagem de programação, o R possui funções para controle de fluxo. Estas funções controlam sob quais condições determinada função será executada. Obviamente, este controles são fundamentais para execução de funções em R. São com estas funções que o R descobre, por exemplo, qual a classe de um objeto, se um vetor possui valores de missing, ou produz mensagens de error.</p>
<p>Os operadores <code>if</code>, <code>else</code> e <code>else if</code> são os principais controladores de fluxo em R. Vejamos como funciona:</p>
<pre class="r"><code>if (condition) {
  # Código executa quando a condição é igual a  TRUE
} else {
  # Executa quando condição é FALSE
}</code></pre>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;condition&#39; not found</code></pre>
<p>Em prática…</p>
<pre class="r"><code>ano=2021

if(ano&gt;=2018) {
  print(&quot;Que saudade de 2013!!&quot;)
} else {
  print(&quot;2013 foi o pior ano da história do Brasil!&quot;)
  }</code></pre>
<pre><code>## [1] &quot;Que saudade de 2013!!&quot;</code></pre>
<div id="condições-múltiplas" class="section level2">
<h2>Condições Múltiplas</h2>
<pre class="r"><code>idade= 30

if(idade&gt;=65) {
  print(&quot;Vacina em Fevereiro&quot;)
} else if(idade &gt; 60 &amp; idade &lt;65) {
  print(&quot;Vacina até junho&quot;)
} else {
    print(&quot;Espere 2022&quot;)
  }</code></pre>
<pre><code>## [1] &quot;Espere 2022&quot;</code></pre>
<div id="controle-de-fluxo-evitando-bugs." class="section level3">
<h3>Controle de Fluxo: Evitando bugs.</h3>
<p>Eu disse na aula passada que o R usa as classes dos objetos para construir suas funções e o que eles podem e não podem fazer. Eu usei o termo “adivinha”. Na verdade, controles de fluxo fazem esta processo de advinhação.</p>
<p>Vamos criar uma função para retirar a média de um vetor numérico. É basicamente desta forma que R constrói suas mensagens de erro.</p>
<pre class="r"><code>x &lt;- sample(1:100, 10)

media_tiago &lt;- function(vector){

  # advinhacao
  if(is.numeric(vector)){
  
    # Calcule a média
    mean(vector)
      
  } else{
    print(&quot;Seu vetor não é numérico&quot;)
  }
  
}

media_tiago(x)</code></pre>
<pre><code>## [1] 50.8</code></pre>
<pre class="r"><code>media_tiago(&quot;hello world&quot;)</code></pre>
<pre><code>## [1] &quot;Seu vetor não é numérico&quot;</code></pre>
</div>
<div id="acabamos-aqui-nossa-introdução-básica-ao-r.-até" class="section level3">
<h3>Acabamos aqui nossa introdução básica ao R. Até!</h3>
</div>
</div>
</div>
